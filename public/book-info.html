<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="BookHaven - 書籍詳情">
    <title>書籍詳情 - BookHaven</title>
    
    <link rel="preconnect" href="https://fonts.bunny.net">
    <link href="https://fonts.bunny.net/css?family=figtree:400,500,600&display=swap" rel="stylesheet">
    
    <!-- 引入現有的 CSS 文件 -->
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/cart.css">
    <link rel="stylesheet" href="css/features.css">
    <link rel="stylesheet" href="css/responsive.css">
    
    <style>
        /* 書籍詳情頁面專用樣式 */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: #6b7280;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .breadcrumb a:hover {
            color: #764ba2;
            text-decoration: underline;
        }

        .breadcrumb-separator {
            color: #d1d5db;
        }

        .book-detail-container {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 3rem;
            margin-bottom: 3rem;
        }

        /* 書籍圖片區域 */
        .book-image-section {
            position: sticky;
            top: 100px;
            height: fit-content;
        }

        .book-main-image {
            width: 100%;
            aspect-ratio: 3/4;
            border-radius: 15px;
            overflow: hidden;
            background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            margin-bottom: 1rem;
            position: relative;
        }

        .book-main-image img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: #f8f9fa;
        }

        .book-badge-large {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(102, 126, 234, 0.9);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            font-weight: 600;
            backdrop-filter: blur(4px);
            z-index: 1;
        }

        .new-badge-large {
            position: absolute;
            top: 20px;
            left: 20px;
            background: linear-gradient(45deg, #f093fb, #f5576c);
            color: white;
            padding: 0.5rem 1.2rem;
            border-radius: 25px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            z-index: 1;
        }

        .image-placeholder {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #9ca3af;
        }

        .image-placeholder svg {
            width: 80px;
            height: 80px;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* 書籍資訊區域 */
        .book-info-section {
            display: flex;
            flex-direction: column;
        }

        .book-detail-title {
            font-size: 2.5rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 1rem;
            line-height: 1.3;
        }

        .book-detail-author {
            font-size: 1.2rem;
            color: #667eea;
            margin-bottom: 1.5rem;
            font-style: italic;
        }

        .book-rating {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stars {
            display: flex;
            gap: 0.25rem;
            color: #fbbf24;
            font-size: 1.2rem;
        }

        .rating-text {
            color: #6b7280;
            font-size: 0.95rem;
        }

        .book-price-section {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
        }

        .book-current-price {
            font-size: 2.5rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .book-original-price {
            text-decoration: line-through;
            color: #9ca3af;
            font-size: 1.3rem;
            margin-right: 1rem;
        }

        .book-discount-badge {
            background: #ef4444;
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 8px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .book-meta-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            background: #f9fafb;
            border-radius: 10px;
        }

        .meta-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .meta-content {
            flex: 1;
        }

        .meta-label {
            font-size: 0.8rem;
            color: #6b7280;
            margin-bottom: 0.25rem;
        }

        .meta-value {
            font-weight: 600;
            color: #333;
        }

        /* 數量選擇器 */
        .quantity-selector {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .quantity-label {
            font-weight: 600;
            color: #333;
        }

        .quantity-controls-large {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: #f3f4f6;
            border-radius: 12px;
            padding: 0.5rem;
        }

        .quantity-btn-large {
            width: 40px;
            height: 40px;
            border: none;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            color: #667eea;
            font-size: 1.2rem;
        }

        .quantity-btn-large:hover {
            background: #667eea;
            color: white;
            transform: scale(1.1);
        }

        .quantity-value-large {
            min-width: 60px;
            text-align: center;
            font-weight: 600;
            font-size: 1.2rem;
            color: #333;
        }

        /* 動作按鈕 */
        .action-buttons {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .add-to-cart-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 1.2rem 2rem;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }

        .add-to-cart-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
        }

        .buy-now-btn {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            padding: 1.2rem 2rem;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .buy-now-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-3px);
        }

        /* 標籤頁 */
        .tabs {
            display: flex;
            gap: 1rem;
            border-bottom: 2px solid #e5e7eb;
            margin-bottom: 2rem;
        }

        .tab {
            padding: 1rem 2rem;
            border: none;
            background: transparent;
            cursor: pointer;
            font-weight: 600;
            color: #6b7280;
            transition: all 0.3s ease;
            position: relative;
        }

        .tab.active {
            color: #667eea;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(45deg, #667eea, #764ba2);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        .description-text {
            color: #4b5563;
            line-height: 1.8;
            font-size: 1.05rem;
        }

        .description-text p {
            margin-bottom: 1rem;
        }

        /* 規格表 */
        .specs-table {
            width: 100%;
            border-collapse: collapse;
        }

        .specs-table tr {
            border-bottom: 1px solid #e5e7eb;
        }

        .specs-table td {
            padding: 1rem;
        }

        .specs-table td:first-child {
            font-weight: 600;
            color: #374151;
            width: 200px;
        }

        .specs-table td:last-child {
            color: #6b7280;
        }

        /* 相關推薦 */
        .related-books {
            margin-top: 4rem;
        }

        .related-books-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
        }

        /* 響應式設計 */
        @media (max-width: 1024px) {
            .book-detail-container {
                grid-template-columns: 1fr;
                gap: 2rem;
            }

            .book-image-section {
                position: static;
            }

            .book-main-image {
                max-width: 400px;
                margin: 0 auto 1rem;
            }

            .related-books-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            .book-detail-title {
                font-size: 2rem;
            }

            .book-current-price {
                font-size: 2rem;
            }

            .action-buttons {
                grid-template-columns: 1fr;
            }

            .book-meta-grid {
                grid-template-columns: 1fr;
            }

            .tabs {
                overflow-x: auto;
                gap: 0.5rem;
            }

            .tab {
                padding: 0.75rem 1rem;
                white-space: nowrap;
            }

            .related-books-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="nav">
            <div class="logo" onclick="window.location.href='index.html'">BookHaven</div>
            <ul class="nav-links">
                <li><a href="index.html">首頁</a></li>
                <li><a href="index.html#books">書籍</a></li>
                <li><a href="#categories">分類</a></li>
                <li><a href="#about">關於我們</a></li>
                <li><a href="#contact">聯絡</a></li>
            </ul>
            <button class="cart-btn" id="cartButton">
                🛒 購物車 (<span id="cart-count">0</span>)
            </button>
        </nav>
    </header>

    <!-- 購物車側邊欄 -->
    <div class="cart-overlay" id="cartOverlay"></div>
    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <h2>🛒 購物車</h2>
            <button class="close-cart-btn" id="closeCartBtn">×</button>
        </div>
        <div class="cart-content" id="cartContent"></div>
        <div class="cart-footer" id="cartFooter">
            <div class="cart-summary">
                <div class="summary-row">
                    <span>商品小計</span>
                    <span id="subtotal">$0.00</span>
                </div>
                <div class="summary-row">
                    <span>運費</span>
                    <span id="shipping">免費</span>
                </div>
                <div class="summary-row total">
                    <span>總計</span>
                    <span id="total">$0.00</span>
                </div>
            </div>
            <button class="checkout-btn" id="checkoutBtn">前往結帳</button>
            <button class="clear-cart-btn" id="clearCartBtn">清空購物車</button>
        </div>
    </div>

    <!-- Hero Section -->
    <section class="hero" style="padding: 2rem;">
        <h1 style="font-size: 2rem;">書籍詳情</h1>
        <p style="font-size: 1rem;">探索書籍的每一個細節</p>
    </section>

    <!-- Main Content -->
    <div class="main-content">
        <!-- 麵包屑導航 -->
        <div class="breadcrumb">
            <a href="index.html">首頁</a>
            <span class="breadcrumb-separator">›</span>
            <a href="index.html#books">書籍列表</a>
            <span class="breadcrumb-separator">›</span>
            <span id="breadcrumbTitle">書籍詳情</span>
        </div>

        <!-- 書籍詳情容器 -->
        <div class="book-detail-container">
            <!-- 左側：書籍圖片 -->
            <div class="book-image-section">
                <div class="book-main-image" id="bookMainImage">
                    <img id="bookImage" src="" alt="書籍封面">
                    <div class="image-placeholder" id="imagePlaceholder">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                                  d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253">
                            </path>
                        </svg>
                        <span>無圖片</span>
                    </div>
                    <div class="book-badge-large" id="bookBadge">#001</div>
                    <div class="new-badge-large" id="newBadge" style="display: none;">NEW</div>
                </div>
            </div>

            <!-- 右側：書籍資訊 -->
            <div class="book-info-section">
                <h1 class="book-detail-title" id="bookTitle">載入中...</h1>
                <div class="book-detail-author" id="bookAuthor">作者資訊</div>

                <!-- 評分 -->
                <div class="book-rating">
                    <div class="stars">
                        <span>⭐</span>
                        <span>⭐</span>
                        <span>⭐</span>
                        <span>⭐</span>
                        <span>⭐</span>
                    </div>
                    <span class="rating-text" id="ratingText">5.0 (128 評價)</span>
                </div>

                <!-- 價格區域 -->
                <div class="book-price-section">
                    <div class="book-current-price" id="currentPrice">$580.00</div>
                    <div id="priceDetails">
                        <span class="book-original-price" id="originalPrice">$680.00</span>
                        <span class="book-discount-badge" id="discountBadge">-15%</span>
                    </div>
                </div>

                <!-- 元資訊網格 -->
                <div class="book-meta-grid" id="metaGrid">
                    <!-- 動態生成 -->
                </div>

                <!-- 數量選擇 -->
                <div class="quantity-selector">
                    <span class="quantity-label">數量：</span>
                    <div class="quantity-controls-large">
                        <button class="quantity-btn-large" onclick="updateQuantity(-1)">−</button>
                        <span class="quantity-value-large" id="quantity">1</span>
                        <button class="quantity-btn-large" onclick="updateQuantity(1)">+</button>
                    </div>
                </div>

                <!-- 動作按鈕 -->
                <div class="action-buttons">
                    <button class="add-to-cart-btn" onclick="addToCartFromDetail()">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 24px; height: 24px;">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z">
                            </path>
                        </svg>
                        加入購物車
                    </button>
                    <button class="buy-now-btn" onclick="buyNow()">
                        立即購買
                    </button>
                </div>
            </div>
        </div>

        <!-- 標籤頁內容 -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('description')">商品描述</button>
            <button class="tab" onclick="switchTab('specs')">規格資訊</button>
            <button class="tab" onclick="switchTab('reviews')">評價 (128)</button>
        </div>

        <div class="tab-content active" id="descriptionTab">
            <div class="description-text" id="bookDescription">
                <p>載入中...</p>
            </div>
        </div>

        <div class="tab-content" id="specsTab">
            <table class="specs-table" id="specsTable">
                <!-- 動態生成 -->
            </table>
        </div>

        <div class="tab-content" id="reviewsTab">
            <div style="text-align: center; padding: 3rem; color: #6b7280;">
                <p style="font-size: 1.1rem; margin-bottom: 1rem;">評價功能開發中</p>
                <p>敬請期待！</p>
            </div>
        </div>

        <!-- 相關推薦 -->
        <div class="related-books">
            <h2 class="section-title">相關推薦</h2>
            <div class="related-books-grid" id="relatedBooks">
                <!-- 動態生成 -->
            </div>
        </div>
    </div>

    <script type="module">
        import { booksData, getBookById } from './js/data.js';

        let currentBook = null;
        let selectedQuantity = 1;

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 從 URL 獲取書籍 ID
            const urlParams = new URLSearchParams(window.location.search);
            const bookId = urlParams.get('id');

            if (bookId) {
                loadBookDetail(parseInt(bookId));
            } else {
                // 如果沒有 ID，顯示第一本書
                loadBookDetail(1);
            }

            // 初始化購物車
            initCart();
            
            // 綁定購物車事件
            setupCartEvents();
        });

        // 載入書籍詳情
        function loadBookDetail(bookId) {
            currentBook = getBookById(bookId);

            if (!currentBook) {
                document.querySelector('.book-detail-title').textContent = '找不到此書籍';
                return;
            }

            // 更新頁面標題
            document.title = `${currentBook.short_title} - BookHaven`;

            // 更新麵包屑
            document.getElementById('breadcrumbTitle').textContent = currentBook.short_title;

            // 更新書籍圖片
            const bookImage = document.getElementById('bookImage');
            const imagePlaceholder = document.getElementById('imagePlaceholder');
            
            if (currentBook.image_url) {
                bookImage.src = currentBook.image_url;
                bookImage.style.display = 'block';
                imagePlaceholder.style.display = 'none';
            } else {
                bookImage.style.display = 'none';
                imagePlaceholder.style.display = 'flex';
            }

            // 更新徽章
            document.getElementById('bookBadge').textContent = `#${String(currentBook.id).padStart(3, '0')}`;
            
            // 顯示 NEW 徽章（前3本書）
            if (currentBook.id <= 3) {
                document.getElementById('newBadge').style.display = 'block';
            }

            // 更新標題和作者
            document.getElementById('bookTitle').textContent = currentBook.short_title;
            document.getElementById('bookAuthor').textContent = currentBook.authors;

            // 更新價格
            document.getElementById('currentPrice').textContent = `$${currentBook.price.toFixed(2)}`;
            
            if (currentBook.original_price && currentBook.original_price > currentBook.price) {
                const discount = Math.round((1 - currentBook.price / currentBook.original_price) * 100);
                document.getElementById('originalPrice').textContent = `$${currentBook.original_price.toFixed(2)}`;
                document.getElementById('discountBadge').textContent = `-${discount}%`;
                document.getElementById('priceDetails').style.display = 'block';
            } else {
                document.getElementById('priceDetails').style.display = 'none';
            }

            // 更新元資訊
            updateMetaGrid(currentBook);

            // 更新描述
            updateDescription(currentBook);

            // 更新規格表
            updateSpecs(currentBook);

            // 載入相關推薦
            loadRelatedBooks(currentBook.id);
        }

        // 更新元資訊網格
        function updateMetaGrid(book) {
            const metaGrid = document.getElementById('metaGrid');
            metaGrid.innerHTML = `
                <div class="meta-item">
                    <div class="meta-icon">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 20px; height: 20px;">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4">
                            </path>
                        </svg>
                    </div>
                    <div class="meta-content">
                        <div class="meta-label">出版社</div>
                        <div class="meta-value">${book.publisher_name}</div>
                    </div>
                </div>
                <div class="meta-item">
                    <div class="meta-icon">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 20px; height: 20px;">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4">
                            </path>
                        </svg>
                    </div>
                    <div class="meta-content">
                        <div class="meta-label">庫存狀態</div>
                        <div class="meta-value">${book.stock_qty > 0 ? `有貨 (${book.stock_qty})` : '缺貨'}</div>
                    </div>
                </div>
                <div class="meta-item">
                    <div class="meta-icon">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 20px; height: 20px;">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z">
                            </path>
                        </svg>
                    </div>
                    <div class="meta-content">
                        <div class="meta-label">配送時間</div>
                        <div class="meta-value">3-5 工作天</div>
                    </div>
                </div>
                <div class="meta-item">
                    <div class="meta-icon">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 20px; height: 20px;">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z">
                            </path>
                        </svg>
                    </div>
                    <div class="meta-content">
                        <div class="meta-label">運送方式</div>
                        <div class="meta-value">全台免運</div>
                    </div>
                </div>
            `;
        }

        // 更新商品描述
        function updateDescription(book) {
            document.getElementById('bookDescription').innerHTML = `
                <p>${book.short_title} 是一本深入淺出的好書，適合對 ${book.short_title.split(' ')[0]} 有興趣的讀者。</p>
                <p>本書由 ${book.authors} 撰寫，以清晰易懂的方式講解複雜的概念，並提供豐富的實例和練習。</p>
                <p>無論您是初學者還是有經驗的專業人士，這本書都能為您帶來寶貴的知識和見解。</p>
                <p><strong>本書特色：</strong></p>
                <ul style="list-style: disc; padding-left: 2rem; margin-top: 0.5rem;">
                    <li>內容豐富，涵蓋核心概念</li>
                    <li>實例豐富，易於理解</li>
                    <li>適合自學或教學使用</li>
                    <li>由 ${book.publisher_name} 精心出版</li>
                </ul>
            `;
        }

        // 更新規格表
        function updateSpecs(book) {
            document.getElementById('specsTable').innerHTML = `
                <tr>
                    <td>書名</td>
                    <td>${book.short_title}</td>
                </tr>
                <tr>
                    <td>作者</td>
                    <td>${book.authors}</td>
                </tr>
                <tr>
                    <td>出版社</td>
                    <td>${book.publisher_name}</td>
                </tr>
                <tr>
                    <td>ISBN</td>
                    <td>978-${Math.floor(Math.random() * 10000000000)}</td>
                </tr>
                <tr>
                    <td>頁數</td>
                    <td>${Math.floor(Math.random() * 400) + 200} 頁</td>
                </tr>
                <tr>
                    <td>語言</td>
                    <td>繁體中文</td>
                </tr>
                <tr>
                    <td>裝訂</td>
                    <td>平裝</td>
                </tr>
                <tr>
                    <td>尺寸</td>
                    <td>17 x 23 cm</td>
                </tr>
            `;
        }

        // 載入相關推薦
        function loadRelatedBooks(currentBookId) {
            const relatedBooksContainer = document.getElementById('relatedBooks');
            const related = booksData
                .filter(book => book.id !== currentBookId)
                .slice(0, 4);

            relatedBooksContainer.innerHTML = related.map(book => `
                <div class="book-card animate-on-scroll" onclick="goToBook(${book.id})">
                    <div class="book-cover">
                        <img src="${book.image_url}" alt="${book.short_title}" loading="lazy">
                        <div class="book-badge">#${String(book.id).padStart(3, '0')}</div>
                    </div>
                    <div class="book-info">
                        <div class="book-details">
                            <h3 class="book-title">${book.short_title}</h3>
                            <p class="book-author">${book.authors}</p>
                            <div class="book-price">
                                ${book.original_price ? `<span class="original-price">$${book.original_price.toFixed(2)}</span>` : ''}
                                <span class="current-price">$${book.price.toFixed(2)}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // 切換標籤頁
        window.switchTab = function(tabName) {
            // 移除所有 active 類
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // 添加 active 到選中的標籤
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        };

        // 更新數量
        window.updateQuantity = function(delta) {
            selectedQuantity = Math.max(1, Math.min(99, selectedQuantity + delta));
            document.getElementById('quantity').textContent = selectedQuantity;
        };

        // 從詳情頁加入購物車
        window.addToCartFromDetail = function() {
            if (!currentBook) return;

            // 使用現有的 addToCart 函數
            for (let i = 0; i < selectedQuantity; i++) {
                addToCartItem(currentBook);
            }

            showNotification(`已將 ${selectedQuantity} 本《${currentBook.short_title}》加入購物車`);
            
            // 打開購物車
            setTimeout(() => {
                document.getElementById('cartSidebar').classList.add('active');
                document.getElementById('cartOverlay').classList.add('active');
            }, 300);
        };

        // 立即購買
        window.buyNow = function() {
            window.addToCartFromDetail();
            setTimeout(() => {
                window.location.href = 'checkout.html';
            }, 500);
        };

        // 跳轉到書籍詳情
        window.goToBook = function(bookId) {
            window.location.href = `book-info.html?id=${bookId}`;
        };

        // 購物車相關函數（簡化版）
        function addToCartItem(book) {
            let cart = JSON.parse(localStorage.getItem('bookhavenCart') || '[]');
            const existingItem = cart.find(item => item.id === book.id);

            if (existingItem) {
                existingItem.quantity++;
            } else {
                cart.push({
                    id: book.id,
                    title: book.short_title,
                    author: book.authors,
                    price: book.price,
                    imageUrl: book.image_url,
                    quantity: 1
                });
            }

            localStorage.setItem('bookhavenCart', JSON.stringify(cart));
            updateCartDisplay();
        }

        function initCart() {
            updateCartDisplay();
        }

        function updateCartDisplay() {
            const cart = JSON.parse(localStorage.getItem('bookhavenCart') || '[]');
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cart-count').textContent = totalItems;
        }

        function setupCartEvents() {
            document.getElementById('cartButton').addEventListener('click', () => {
                document.getElementById('cartSidebar').classList.add('active');
                document.getElementById('cartOverlay').classList.add('active');
            });

            document.getElementById('closeCartBtn').addEventListener('click', () => {
                document.getElementById('cartSidebar').classList.remove('active');
                document.getElementById('cartOverlay').classList.remove('active');
            });

            document.getElementById('cartOverlay').addEventListener('click', () => {
                document.getElementById('cartSidebar').classList.remove('active');
                document.getElementById('cartOverlay').classList.remove('active');
            });
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.classList.add('hide');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 500);
            }, 3000);
        }
    </script>
</body>
</html>